<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Un pied à l'étrier</title>
    <style>
        body {
            background-color: antiquewhite;
        }
    </style>
</head>
<body>
    <div style="display: flex; gap: 20px; align-items: flex-start;">    
        <canvas id="my_canvas"></canvas>
    </div>
    <script>
        class Model {
            constructor() {
                this.grid = [
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1 ,1, 1, 0, 0, 0, 0],
                    [0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 2, 0],
                    [0, 2, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0],
                    [0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0],
                    [0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0],
                    [0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0],
                    [0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0 ,0 ,0 ,0],
                    [0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0 ,0 ,0],
                    [0, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 0, 0, 1, 0, 0 ,0 ,0],
                    [0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0],
                    [0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0],
                    [0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0],
                    [0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0],
                    [0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0],
                    [0, 1, 0, 1, 0 ,1, 0, 0, 1, 0, 1, 0, 1, 1, 2, 1, 1, 0],
                    [0, 1, 1, 1, 0, 2, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                ];
                this.nbLines   = (this.grid).length; // Nombre d'éléments dans le tableau (nombre de lignes).
                this.nbColumns = (this.grid[0]).length; // Nombre de colonnes.
            }
            bindDisplayCNF(callback) {
                this.displayCNF = callback;
            }
            Play() {
                this.displayCNF(this.grid);
            }
            //Fonction move
            
        }

        class View {
          constructor() {
            this._cellSize  = 250; // La taille d'une cellule en pixel.
          }
          Display(grid) {
            let _nbLines   = (grid).length; // Nombre d'éléments dans le tableau (nombre de lignes).
            let _nbColumns = (grid[0]).length;

            let canvas = document.getElementById('my_canvas'); // Récupération d'une balise HTML par son ID.
            canvas.width  = _nbColumns * this._cellSize;
            canvas.height = _nbLines * this._cellSize;
            let ctx = canvas.getContext('2d'); // Récupération de la surface de dessin.
            for (let i_line = 0; i_line < _nbLines; i_line++) { // Boucles for pour afficher la grille.
                for (let i_col = 0; i_col < _nbColumns; i_col++) {
                    if (grid[i_line][i_col] == 1) {
                            ctx.drawImage(HEXTILES_IMAGE, 0, 0, 32, 32, i_col * this._cellSize, i_line * this._cellSize, this._cellSize, this._cellSize);
                    } else if (grid[i_line][i_col] == 0) {
                            ctx.drawImage(TWO_IMAGE, 156, 190, 38, 32, i_col * this._cellSize, i_line * this._cellSize, this._cellSize, this._cellSize);
                    } else if (grid[i_line][i_col] == 2) {
                            ctx.drawImage(HEXTILES_IMAGE, 64,0, 32, 32, i_col * this._cellSize, i_line * this._cellSize, this._cellSize, this._cellSize);
                    } else if (grid[i_line][i_col] == 3) {
                            ctx.drawImage(HEXTILES_IMAGE, 128,0, 32, 32, i_col * this._cellSize, i_line * this._cellSize, this._cellSize, this._cellSize);
                    }  
                }
            }
          }
        }

        class Controller {
          constructor(model, view) {
            this.model = model
            this.view = view
            // fonction qui permet de lier le model et la view
            this.bindDisplayCNF = this.bindDisplayCNF.bind(this);
            this.model.bindDisplayCNF(this.bindDisplayCNF);

            this.model.Play()

          }
          bindDisplayCNF (cnf_value) {
            this.view.Display(cnf_value);
        }

        }
        const HEXTILES_IMAGE = new Image();
        HEXTILES_IMAGE.src = 'foodAndColony.png';
        const TWO_IMAGE = new Image();
        TWO_IMAGE.src = 'tree.png';
        Promise.all([
            new Promise( (resolve) => {HEXTILES_IMAGE.addEventListener('load', () => { resolve();}); }),
            // new Promise( (resolve) => {TWO_IMAGE.addEventListener('load', () => { resolve();}); }),
        ])
        .then(() => {   
            const app = new Controller(new Model(), new View())

        });      
    </script>
    
</body>
</html>